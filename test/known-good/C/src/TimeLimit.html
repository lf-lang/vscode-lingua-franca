<span class="source-lf comment-line-double-dash-lflang">
// Test that the stop function can be used to internally impose a a time limit. Correct output for
</span>

<span class="source-lf comment-line-double-dash-lflang">
// this 1, 2, 3, 4. Failure for this test is failing to halt or getting the wrong data.
</span>

<span class="source-lf meta-targetspec-lflang keyword-control-lflang">
target
</span>
<span class="source-lf meta-targetspec-lflang">
 
</span>
<span class="source-lf meta-targetspec-lflang constant-language-lflang">
C
</span>
<span class="source-lf meta-targetspec-lflang">
 {
</span>

<span class="source-lf meta-targetspec-lflang variable-parameter-lflang">
  fast
</span>
<span class="source-lf meta-targetspec-lflang">
: 
</span>
<span class="source-lf meta-targetspec-lflang constant-language-lflang">
true
</span>

<span class="source-lf meta-targetspec-lflang">
}
</span>

<span class="source-lf">

</span>

<span class="source-lf storage-modifier-lflang">
reactor
</span>
<span class="source-lf">
 
</span>
<span class="source-lf entity-name-type-lflang">
Clock
</span>
<span class="source-lf">
(offset: 
</span>
<span class="source-lf storage-type-lflang">
time
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
 
</span>
<span class="source-lf constant-numeric-int-lflang">
0
</span>
<span class="source-lf">
, period: 
</span>
<span class="source-lf storage-type-lflang">
time
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
 
</span>
<span class="source-lf constant-numeric-int-lflang">
1
</span>
<span class="source-lf">
 
</span>
<span class="source-lf constant-numeric-lflang">
sec
</span>
<span class="source-lf">
) {
</span>

<span class="source-lf">
  
</span>
<span class="source-lf storage-modifier-lflang">
output
</span>
<span class="source-lf">
 
</span>
<span class="source-lf variable-other-lflang">
y
</span>
<span class="source-lf">
:
</span>
<span class="source-lf meta-embedded-block-cpp">
 
</span>
<span class="source-lf meta-embedded-block-cpp storage-type-lflang">
int
</span>

<span class="source-lf">
  
</span>
<span class="source-lf storage-modifier-lflang">
timer
</span>
<span class="source-lf">
 t(offset, period)
</span>

<span class="source-lf">
  
</span>
<span class="source-lf storage-modifier-lflang">
state
</span>
<span class="source-lf">
 
</span>
<span class="source-lf variable-other-lflang">
count
</span>
<span class="source-lf">
:
</span>
<span class="source-lf meta-embedded-block-cpp">
 
</span>
<span class="source-lf meta-embedded-block-cpp storage-type-lflang">
int
</span>
<span class="source-lf meta-embedded-block-cpp">
 
</span>
<span class="source-lf">
=
</span>
<span class="source-lf">
 
</span>
<span class="source-lf constant-numeric-int-lflang">
0
</span>

<span class="source-lf">

</span>

<span class="source-lf">
  
</span>
<span class="source-lf keyword-control-lflang">
reaction
</span>
<span class="source-lf">
(
</span>
<span class="source-lf">
t) 
</span>
<span class="source-lf keyword-operator-lflang">
->
</span>
<span class="source-lf">
 y {
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>

<span class="source-lf">
    (self
</span>
<span class="source-lf keyword-operator-lflang">
->
</span>
<span class="source-lf">
count)
</span>
<span class="source-lf keyword-operator-lflang">
+
</span>
<span class="source-lf keyword-operator-lflang">
+
</span>
<span class="source-lf">
;
</span>

<span class="source-lf comment-line-double-dash-lflang">
    
</span>
<span class="source-lf comment-line-double-dash-lflang">
//printf("Reacting at time %ld.\n", lf_time_logical_elapsed());
</span>

<span class="source-lf">
    lf_set(y, self
</span>
<span class="source-lf keyword-operator-lflang">
->
</span>
<span class="source-lf">
count);
</span>

<span class="source-lf">
  
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
}
</span>

<span class="source-lf">
}
</span>

<span class="source-lf">

</span>

<span class="source-lf storage-modifier-lflang">
reactor
</span>
<span class="source-lf">
 
</span>
<span class="source-lf entity-name-type-lflang">
Destination
</span>
<span class="source-lf">
 {
</span>

<span class="source-lf">
  
</span>
<span class="source-lf storage-modifier-lflang">
input
</span>
<span class="source-lf">
 
</span>
<span class="source-lf variable-other-lflang">
x
</span>
<span class="source-lf">
:
</span>
<span class="source-lf meta-embedded-block-cpp">
 
</span>
<span class="source-lf meta-embedded-block-cpp storage-type-lflang">
int
</span>

<span class="source-lf">
  
</span>
<span class="source-lf storage-modifier-lflang">
state
</span>
<span class="source-lf">
 
</span>
<span class="source-lf variable-other-lflang">
s
</span>
<span class="source-lf">
:
</span>
<span class="source-lf meta-embedded-block-cpp">
 
</span>
<span class="source-lf meta-embedded-block-cpp storage-type-lflang">
int
</span>
<span class="source-lf meta-embedded-block-cpp">
 
</span>
<span class="source-lf">
=
</span>
<span class="source-lf">
 
</span>
<span class="source-lf constant-numeric-int-lflang">
1
</span>

<span class="source-lf">

</span>

<span class="source-lf">
  
</span>
<span class="source-lf keyword-control-lflang">
reaction
</span>
<span class="source-lf">
(
</span>
<span class="source-lf">
x) {
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>

<span class="source-lf comment-line-double-dash-lflang">
    
</span>
<span class="source-lf comment-line-double-dash-lflang">
// printf("%d\n", x->value);
</span>

<span class="source-lf">
    if (x
</span>
<span class="source-lf keyword-operator-lflang">
->
</span>
<span class="source-lf">
value !
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
 self
</span>
<span class="source-lf keyword-operator-lflang">
->
</span>
<span class="source-lf">
s) {
</span>

<span class="source-lf">
      printf(
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf string-quoted-double-lflang">
Error: Expected %d and got %d.
</span>
<span class="source-lf string-quoted-double-lflang constant-character-escape">
\n
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf">
, self
</span>
<span class="source-lf keyword-operator-lflang">
->
</span>
<span class="source-lf">
s, x
</span>
<span class="source-lf keyword-operator-lflang">
->
</span>
<span class="source-lf">
value);
</span>

<span class="source-lf">
      exit(
</span>
<span class="source-lf constant-numeric-int-lflang">
1
</span>
<span class="source-lf">
);
</span>

<span class="source-lf">
    }
</span>

<span class="source-lf">
    self
</span>
<span class="source-lf keyword-operator-lflang">
->
</span>
<span class="source-lf">
s
</span>
<span class="source-lf keyword-operator-lflang">
+
</span>
<span class="source-lf keyword-operator-lflang">
+
</span>
<span class="source-lf">
;
</span>

<span class="source-lf">
  
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
}
</span>

<span class="source-lf">

</span>

<span class="source-lf">
  
</span>
<span class="source-lf keyword-control-lflang">
reaction
</span>
<span class="source-lf">
(
</span>
<span class="source-lf support-variable-lflang">
shutdown
</span>
<span class="source-lf">
) {
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>

<span class="source-lf">
    printf(
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf string-quoted-double-lflang">
**** shutdown reaction invoked.
</span>
<span class="source-lf string-quoted-double-lflang constant-character-escape">
\n
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf">
);
</span>

<span class="source-lf">
    if (self
</span>
<span class="source-lf keyword-operator-lflang">
->
</span>
<span class="source-lf">
s !
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
 
</span>
<span class="source-lf constant-numeric-int-lflang">
12
</span>
<span class="source-lf">
) {
</span>

<span class="source-lf">
      fprintf(stderr, 
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf string-quoted-double-lflang">
ERROR: Expected 12 but got %d.
</span>
<span class="source-lf string-quoted-double-lflang constant-character-escape">
\n
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf">
, self
</span>
<span class="source-lf keyword-operator-lflang">
->
</span>
<span class="source-lf">
s);
</span>

<span class="source-lf">
      exit(
</span>
<span class="source-lf constant-numeric-int-lflang">
1
</span>
<span class="source-lf">
);
</span>

<span class="source-lf">
    }
</span>

<span class="source-lf">
  
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
}
</span>

<span class="source-lf">
}
</span>

<span class="source-lf">

</span>

<span class="source-lf storage-modifier-lflang">
main
</span>
<span class="source-lf">
 
</span>
<span class="source-lf storage-modifier-lflang">
reactor
</span>
<span class="source-lf">
 
</span>
<span class="source-lf entity-name-type-lflang">
TimeLimit
</span>
<span class="source-lf">
(period: 
</span>
<span class="source-lf storage-type-lflang">
time
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
 
</span>
<span class="source-lf constant-numeric-int-lflang">
1
</span>
<span class="source-lf">
 
</span>
<span class="source-lf constant-numeric-lflang">
sec
</span>
<span class="source-lf">
) {
</span>

<span class="source-lf">
  
</span>
<span class="source-lf storage-modifier-lflang">
timer
</span>
<span class="source-lf">
 stop(
</span>
<span class="source-lf constant-numeric-int-lflang">
10
</span>
<span class="source-lf">
 
</span>
<span class="source-lf constant-numeric-lflang">
sec
</span>
<span class="source-lf">
)
</span>

<span class="source-lf">
  
</span>
<span class="source-lf variable-other-constant-reactorinstance-lflang">
c
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-control-new-lflang">
new
</span>
<span class="source-lf">
 
</span>
<span class="source-lf entity-name-type-lflang">
Clock
</span>
<span class="source-lf">
(period
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
period)
</span>

<span class="source-lf">
  
</span>
<span class="source-lf variable-other-constant-reactorinstance-lflang">
d
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-control-new-lflang">
new
</span>
<span class="source-lf">
 
</span>
<span class="source-lf entity-name-type-lflang">
Destination
</span>
<span class="source-lf">
()
</span>

<span class="source-lf">
  
</span>
<span class="source-lf variable-other-constant-reactorinstance-lflang">
c
</span>
<span class="source-lf keyword-operator-lflang">
.
</span>
<span class="source-lf variable-other-lflang">
y
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-operator-lflang">
->
</span>
<span class="source-lf">
 
</span>
<span class="source-lf variable-other-constant-reactorinstance-lflang">
d
</span>
<span class="source-lf keyword-operator-lflang">
.
</span>
<span class="source-lf variable-other-lflang">
x
</span>

<span class="source-lf">

</span>

<span class="source-lf">
  
</span>
<span class="source-lf keyword-control-lflang">
reaction
</span>
<span class="source-lf">
(
</span>
<span class="source-lf">
stop) {
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>

<span class="source-lf">
    lf_request_stop();
</span>

<span class="source-lf">
  
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
}
</span>

<span class="source-lf">
}
</span>

<span class="source-lf">

</span>

