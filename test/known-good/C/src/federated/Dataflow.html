<span class="source-lf meta-targetspec-lflang keyword-control-lflang">
target
</span>
<span class="source-lf meta-targetspec-lflang">
 
</span>
<span class="source-lf meta-targetspec-lflang constant-language-lflang">
C
</span>
<span class="source-lf meta-targetspec-lflang">
 {
</span>

<span class="source-lf meta-targetspec-lflang variable-parameter-lflang">
  coordination
</span>
<span class="source-lf meta-targetspec-lflang">
: 
</span>
<span class="source-lf meta-targetspec-lflang storage-type-lflang">
decentralized
</span>
<span class="source-lf meta-targetspec-lflang">
  
</span>
<span class="source-lf meta-targetspec-lflang comment-line-double-dash-lflang">
// logging: debug
</span>

<span class="source-lf meta-targetspec-lflang">
}
</span>

<span class="source-lf">

</span>

<span class="source-lf storage-modifier-lflang">
reactor
</span>
<span class="source-lf">
 
</span>
<span class="source-lf entity-name-type-lflang">
Client
</span>
<span class="source-lf">
(STP_offset: 
</span>
<span class="source-lf storage-type-lflang">
time
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
 
</span>
<span class="source-lf constant-numeric-int-lflang">
1
</span>
<span class="source-lf">
 
</span>
<span class="source-lf constant-numeric-lflang">
day
</span>
<span class="source-lf">
) {
</span>

<span class="source-lf">
  
</span>
<span class="source-lf storage-modifier-lflang">
input
</span>
<span class="source-lf">
 
</span>
<span class="source-lf variable-other-lflang">
server_message
</span>
<span class="source-lf">
:
</span>
<span class="source-lf meta-embedded-block-cpp">
 
</span>
<span class="source-lf meta-embedded-block-cpp storage-type-lflang">
int
</span>

<span class="source-lf">
  
</span>
<span class="source-lf storage-modifier-lflang">
output
</span>
<span class="source-lf">
 
</span>
<span class="source-lf variable-other-lflang">
client_message
</span>
<span class="source-lf">
:
</span>
<span class="source-lf meta-embedded-block-cpp">
 
</span>
<span class="source-lf meta-embedded-block-cpp storage-type-lflang">
int
</span>

<span class="source-lf">

</span>

<span class="source-lf">
  
</span>
<span class="source-lf keyword-control-lflang">
reaction
</span>
<span class="source-lf">
(
</span>
<span class="source-lf support-variable-lflang">
startup
</span>
<span class="source-lf">
) {
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>

<span class="source-lf">
    lf_print(
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf string-quoted-double-lflang">
Client Startup!
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf">
);
</span>

<span class="source-lf">
  
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
}
</span>

<span class="source-lf">

</span>

<span class="source-lf">
  
</span>
<span class="source-lf keyword-control-lflang">
reaction
</span>
<span class="source-lf">
(
</span>
<span class="source-lf">
server_message) 
</span>
<span class="source-lf keyword-operator-lflang">
->
</span>
<span class="source-lf">
 client_message {
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>

<span class="source-lf">
    int val 
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
 server_message
</span>
<span class="source-lf keyword-operator-lflang">
->
</span>
<span class="source-lf">
value 
</span>
<span class="source-lf keyword-operator-lflang">
+
</span>
<span class="source-lf">
 
</span>
<span class="source-lf constant-numeric-int-lflang">
1
</span>
<span class="source-lf">
;
</span>

<span class="source-lf">
    lf_sleep(MSEC(
</span>
<span class="source-lf constant-numeric-int-lflang">
100
</span>
<span class="source-lf">
));
</span>

<span class="source-lf">
    lf_print(
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf string-quoted-double-lflang">
client: %d
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf">
, val);
</span>

<span class="source-lf">
    if (val 
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
 
</span>
<span class="source-lf constant-numeric-int-lflang">
9
</span>
<span class="source-lf">
) {
</span>

<span class="source-lf">
      lf_print(
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf string-quoted-double-lflang">
client requesting stop
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf">
);
</span>

<span class="source-lf">
      lf_request_stop();
</span>

<span class="source-lf">
    }
</span>

<span class="source-lf">
    lf_set(client_message, val);
</span>

<span class="source-lf">
  
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
} 
</span>
<span class="source-lf keyword-control-lflang">
STP
</span>
<span class="source-lf">
(
</span>
<span class="source-lf constant-numeric-int-lflang">
0
</span>
<span class="source-lf">
) {
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>

<span class="source-lf comment-line-double-dash-lflang">
    
</span>
<span class="source-lf comment-line-double-dash-lflang">
// Zero STAA because STA is large and gets added.
</span>

<span class="source-lf">
    lf_print_error_and_exit(
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf string-quoted-double-lflang">
Client STP Violated!
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf">
);
</span>

<span class="source-lf">
  
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
}
</span>

<span class="source-lf">
}
</span>

<span class="source-lf">

</span>

<span class="source-lf storage-modifier-lflang">
reactor
</span>
<span class="source-lf">
 
</span>
<span class="source-lf entity-name-type-lflang">
Server
</span>
<span class="source-lf">
(STP_offset: 
</span>
<span class="source-lf storage-type-lflang">
time
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
 
</span>
<span class="source-lf constant-numeric-int-lflang">
1
</span>
<span class="source-lf">
 
</span>
<span class="source-lf constant-numeric-lflang">
day
</span>
<span class="source-lf">
) {
</span>

<span class="source-lf">
  
</span>
<span class="source-lf storage-modifier-lflang">
output
</span>
<span class="source-lf">
 
</span>
<span class="source-lf variable-other-lflang">
server_message
</span>
<span class="source-lf">
:
</span>
<span class="source-lf meta-embedded-block-cpp">
 
</span>
<span class="source-lf meta-embedded-block-cpp storage-type-lflang">
int
</span>

<span class="source-lf">
  
</span>
<span class="source-lf storage-modifier-lflang">
input
</span>
<span class="source-lf">
 
</span>
<span class="source-lf variable-other-lflang">
client_message1
</span>
<span class="source-lf">
:
</span>
<span class="source-lf meta-embedded-block-cpp">
 
</span>
<span class="source-lf meta-embedded-block-cpp storage-type-lflang">
int
</span>

<span class="source-lf">
  
</span>
<span class="source-lf storage-modifier-lflang">
input
</span>
<span class="source-lf">
 
</span>
<span class="source-lf variable-other-lflang">
client_message2
</span>
<span class="source-lf">
:
</span>
<span class="source-lf meta-embedded-block-cpp">
 
</span>
<span class="source-lf meta-embedded-block-cpp storage-type-lflang">
int
</span>

<span class="source-lf">

</span>

<span class="source-lf">
  
</span>
<span class="source-lf keyword-control-lflang">
reaction
</span>
<span class="source-lf">
(
</span>
<span class="source-lf support-variable-lflang">
startup
</span>
<span class="source-lf">
) 
</span>
<span class="source-lf keyword-operator-lflang">
->
</span>
<span class="source-lf">
 server_message {
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>

<span class="source-lf">
    lf_print(
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf string-quoted-double-lflang">
Server Startup!
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf">
);
</span>

<span class="source-lf">
    lf_set(server_message, 
</span>
<span class="source-lf constant-numeric-int-lflang">
0
</span>
<span class="source-lf">
);
</span>

<span class="source-lf">
  
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
}
</span>

<span class="source-lf">

</span>

<span class="source-lf">
  
</span>
<span class="source-lf keyword-control-lflang">
reaction
</span>
<span class="source-lf">
(
</span>
<span class="source-lf">
client_message1, client_message2) 
</span>
<span class="source-lf keyword-operator-lflang">
->
</span>
<span class="source-lf">
 server_message {
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>

<span class="source-lf">
    int val 
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
 client_message1
</span>
<span class="source-lf keyword-operator-lflang">
->
</span>
<span class="source-lf">
value;
</span>

<span class="source-lf">
    if (val < client_message2
</span>
<span class="source-lf keyword-operator-lflang">
->
</span>
<span class="source-lf">
value) val 
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
 client_message2
</span>
<span class="source-lf keyword-operator-lflang">
->
</span>
<span class="source-lf">
value;
</span>

<span class="source-lf">
    lf_sleep(MSEC(
</span>
<span class="source-lf constant-numeric-int-lflang">
100
</span>
<span class="source-lf">
));
</span>

<span class="source-lf">
    val 
</span>
<span class="source-lf keyword-operator-lflang">
+
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
 
</span>
<span class="source-lf constant-numeric-int-lflang">
1
</span>
<span class="source-lf">
;
</span>

<span class="source-lf">
    lf_print(
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf string-quoted-double-lflang">
server: %d
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf">
, val);
</span>

<span class="source-lf">
    if (val 
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
 
</span>
<span class="source-lf constant-numeric-int-lflang">
8
</span>
<span class="source-lf">
) {
</span>

<span class="source-lf">
      lf_print(
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf string-quoted-double-lflang">
server requesting stop
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf">
);
</span>

<span class="source-lf">
      lf_set(server_message, val);
</span>

<span class="source-lf">
      lf_request_stop();
</span>

<span class="source-lf">
    }
</span>

<span class="source-lf">
    lf_set(server_message, val);
</span>

<span class="source-lf">
  
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
} 
</span>
<span class="source-lf keyword-control-lflang">
STP
</span>
<span class="source-lf">
(
</span>
<span class="source-lf constant-numeric-int-lflang">
0
</span>
<span class="source-lf">
) {
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>

<span class="source-lf comment-line-double-dash-lflang">
    
</span>
<span class="source-lf comment-line-double-dash-lflang">
// Zero STAA because STA is large and gets added.
</span>

<span class="source-lf">
    lf_print_error_and_exit(
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf string-quoted-double-lflang">
Server STP Violated!
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf">
);
</span>

<span class="source-lf">
  
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
}
</span>

<span class="source-lf">
}
</span>

<span class="source-lf">

</span>

<span class="source-lf storage-modifier-lflang">
federated
</span>
<span class="source-lf">
 
</span>
<span class="source-lf storage-modifier-lflang">
reactor
</span>
<span class="source-lf">
 {
</span>

<span class="source-lf">
  
</span>
<span class="source-lf variable-other-constant-reactorinstance-lflang">
client1
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-control-new-lflang">
new
</span>
<span class="source-lf">
 
</span>
<span class="source-lf entity-name-type-lflang">
Client
</span>
<span class="source-lf">
()
</span>

<span class="source-lf">
  
</span>
<span class="source-lf variable-other-constant-reactorinstance-lflang">
client2
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-control-new-lflang">
new
</span>
<span class="source-lf">
 
</span>
<span class="source-lf entity-name-type-lflang">
Client
</span>
<span class="source-lf">
()
</span>

<span class="source-lf">
  
</span>
<span class="source-lf variable-other-constant-reactorinstance-lflang">
server
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-control-new-lflang">
new
</span>
<span class="source-lf">
 
</span>
<span class="source-lf entity-name-type-lflang">
Server
</span>
<span class="source-lf">
()
</span>

<span class="source-lf">
  
</span>
<span class="source-lf variable-other-constant-reactorinstance-lflang">
server
</span>
<span class="source-lf keyword-operator-lflang">
.
</span>
<span class="source-lf variable-other-lflang">
server_message
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-operator-lflang">
->
</span>
<span class="source-lf">
 
</span>
<span class="source-lf variable-other-constant-reactorinstance-lflang">
client1
</span>
<span class="source-lf keyword-operator-lflang">
.
</span>
<span class="source-lf variable-other-lflang">
server_message
</span>

<span class="source-lf">
  
</span>
<span class="source-lf variable-other-constant-reactorinstance-lflang">
client1
</span>
<span class="source-lf keyword-operator-lflang">
.
</span>
<span class="source-lf variable-other-lflang">
client_message
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-operator-lflang">
->
</span>
<span class="source-lf">
 
</span>
<span class="source-lf variable-other-constant-reactorinstance-lflang">
server
</span>
<span class="source-lf keyword-operator-lflang">
.
</span>
<span class="source-lf variable-other-lflang">
client_message1
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-control-lflang">
after
</span>
<span class="source-lf">
 
</span>
<span class="source-lf constant-numeric-int-lflang">
0
</span>

<span class="source-lf">
  
</span>
<span class="source-lf variable-other-constant-reactorinstance-lflang">
server
</span>
<span class="source-lf keyword-operator-lflang">
.
</span>
<span class="source-lf variable-other-lflang">
server_message
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-operator-lflang">
->
</span>
<span class="source-lf">
 
</span>
<span class="source-lf variable-other-constant-reactorinstance-lflang">
client2
</span>
<span class="source-lf keyword-operator-lflang">
.
</span>
<span class="source-lf variable-other-lflang">
server_message
</span>

<span class="source-lf">
  
</span>
<span class="source-lf variable-other-constant-reactorinstance-lflang">
client2
</span>
<span class="source-lf keyword-operator-lflang">
.
</span>
<span class="source-lf variable-other-lflang">
client_message
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-operator-lflang">
->
</span>
<span class="source-lf">
 
</span>
<span class="source-lf variable-other-constant-reactorinstance-lflang">
server
</span>
<span class="source-lf keyword-operator-lflang">
.
</span>
<span class="source-lf variable-other-lflang">
client_message2
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-control-lflang">
after
</span>
<span class="source-lf">
 
</span>
<span class="source-lf constant-numeric-int-lflang">
0
</span>

<span class="source-lf">
}
</span>

<span class="source-lf">

</span>

