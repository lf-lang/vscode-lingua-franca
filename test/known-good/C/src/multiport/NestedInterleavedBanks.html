<span class="source-lf comment-block-lflang">
/**
</span>

<span class="source-lf comment-block-lflang">
 * Test nested banks with interleaving.
</span>

<span class="source-lf comment-block-lflang">
 * @author Edward A. Lee
</span>

<span class="source-lf comment-block-lflang">
 
</span>
<span class="source-lf comment-block-lflang">
*/
</span>

<span class="source-lf meta-targetspec-lflang keyword-control-lflang">
target
</span>
<span class="source-lf meta-targetspec-lflang">
 
</span>
<span class="source-lf meta-targetspec-lflang constant-language-lflang">
C
</span>

<span class="source-lf">

</span>

<span class="source-lf storage-modifier-lflang">
reactor
</span>
<span class="source-lf">
 
</span>
<span class="source-lf entity-name-type-lflang">
A
</span>
<span class="source-lf">
(bank_index: 
</span>
<span class="source-lf storage-type-lflang">
int
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
 
</span>
<span class="source-lf constant-numeric-int-lflang">
0
</span>
<span class="source-lf">
, outer_bank_index: 
</span>
<span class="source-lf storage-type-lflang">
int
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
 
</span>
<span class="source-lf constant-numeric-int-lflang">
0
</span>
<span class="source-lf">
) {
</span>

<span class="source-lf">
  
</span>
<span class="source-lf storage-modifier-lflang">
output
</span>
<span class="source-lf">
[
</span>
<span class="source-lf variable-other-lflang">
2
</span>
<span class="source-lf">
] 
</span>
<span class="source-lf variable-other-lflang">
p
</span>
<span class="source-lf">
:
</span>
<span class="source-lf meta-embedded-block-cpp">
 
</span>
<span class="source-lf meta-embedded-block-cpp storage-type-lflang">
int
</span>

<span class="source-lf">

</span>

<span class="source-lf">
  
</span>
<span class="source-lf keyword-control-lflang">
reaction
</span>
<span class="source-lf">
(
</span>
<span class="source-lf support-variable-lflang">
startup
</span>
<span class="source-lf">
) 
</span>
<span class="source-lf keyword-operator-lflang">
->
</span>
<span class="source-lf">
 p {
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>

<span class="source-lf">
    for (int i 
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
 
</span>
<span class="source-lf constant-numeric-int-lflang">
0
</span>
<span class="source-lf">
; i < p_width; i
</span>
<span class="source-lf keyword-operator-lflang">
+
</span>
<span class="source-lf keyword-operator-lflang">
+
</span>
<span class="source-lf">
) {
</span>

<span class="source-lf">
      lf_set(p[i], self
</span>
<span class="source-lf keyword-operator-lflang">
->
</span>
<span class="source-lf">
outer_bank_index 
</span>
<span class="source-lf keyword-operator-lflang">
*
</span>
<span class="source-lf">
 
</span>
<span class="source-lf constant-numeric-int-lflang">
4
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-operator-lflang">
+
</span>
<span class="source-lf">
 self
</span>
<span class="source-lf keyword-operator-lflang">
->
</span>
<span class="source-lf">
bank_index 
</span>
<span class="source-lf keyword-operator-lflang">
*
</span>
<span class="source-lf">
 
</span>
<span class="source-lf constant-numeric-int-lflang">
2
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-operator-lflang">
+
</span>
<span class="source-lf">
 i 
</span>
<span class="source-lf keyword-operator-lflang">
+
</span>
<span class="source-lf">
 
</span>
<span class="source-lf constant-numeric-int-lflang">
1
</span>
<span class="source-lf">
);
</span>

<span class="source-lf">
      lf_print(
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf string-quoted-double-lflang">
A sending %d.
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf">
, p[i]
</span>
<span class="source-lf keyword-operator-lflang">
->
</span>
<span class="source-lf">
value);
</span>

<span class="source-lf">
    }
</span>

<span class="source-lf">
  
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
}
</span>

<span class="source-lf">
}
</span>

<span class="source-lf">

</span>

<span class="source-lf storage-modifier-lflang">
reactor
</span>
<span class="source-lf">
 
</span>
<span class="source-lf entity-name-type-lflang">
B
</span>
<span class="source-lf">
(bank_index: 
</span>
<span class="source-lf storage-type-lflang">
int
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
 
</span>
<span class="source-lf constant-numeric-int-lflang">
0
</span>
<span class="source-lf">
) {
</span>

<span class="source-lf">
  
</span>
<span class="source-lf storage-modifier-lflang">
output
</span>
<span class="source-lf">
[
</span>
<span class="source-lf variable-other-lflang">
4
</span>
<span class="source-lf">
] 
</span>
<span class="source-lf variable-other-lflang">
q
</span>
<span class="source-lf">
:
</span>
<span class="source-lf meta-embedded-block-cpp">
 
</span>
<span class="source-lf meta-embedded-block-cpp storage-type-lflang">
int
</span>

<span class="source-lf">
  
</span>
<span class="source-lf variable-other-constant-reactorinstance-lflang">
a
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-control-new-lflang">
new
</span>
<span class="source-lf">
[
</span>
<span class="source-lf constant-numeric-int-lflang">
2
</span>
<span class="source-lf">
] A(outer_bank_index
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
bank_index)
</span>

<span class="source-lf">
  
</span>
<span class="source-lf keyword-control-lflang">
interleaved
</span>
<span class="source-lf">
(
</span>
<span class="source-lf variable-other-constant-reactorinstance-lflang">
a
</span>
<span class="source-lf keyword-operator-lflang">
.
</span>
<span class="source-lf variable-other-lflang">
p
</span>
<span class="source-lf">
) 
</span>
<span class="source-lf keyword-operator-lflang">
->
</span>
<span class="source-lf">
 q
</span>

<span class="source-lf">
}
</span>

<span class="source-lf">

</span>

<span class="source-lf storage-modifier-lflang">
reactor
</span>
<span class="source-lf">
 
</span>
<span class="source-lf entity-name-type-lflang">
C
</span>
<span class="source-lf">
 {
</span>

<span class="source-lf">
  
</span>
<span class="source-lf storage-modifier-lflang">
input
</span>
<span class="source-lf">
[8] i:
</span>
<span class="source-lf meta-embedded-block-cpp">
 
</span>
<span class="source-lf meta-embedded-block-cpp storage-type-lflang">
int
</span>

<span class="source-lf">

</span>

<span class="source-lf">
  
</span>
<span class="source-lf keyword-control-lflang">
reaction
</span>
<span class="source-lf">
(
</span>
<span class="source-lf">
i) {
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>

<span class="source-lf">
    int expected[] 
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
 {
</span>
<span class="source-lf constant-numeric-int-lflang">
1
</span>
<span class="source-lf">
, 
</span>
<span class="source-lf constant-numeric-int-lflang">
3
</span>
<span class="source-lf">
, 
</span>
<span class="source-lf constant-numeric-int-lflang">
2
</span>
<span class="source-lf">
, 
</span>
<span class="source-lf constant-numeric-int-lflang">
4
</span>
<span class="source-lf">
, 
</span>
<span class="source-lf constant-numeric-int-lflang">
5
</span>
<span class="source-lf">
, 
</span>
<span class="source-lf constant-numeric-int-lflang">
7
</span>
<span class="source-lf">
, 
</span>
<span class="source-lf constant-numeric-int-lflang">
6
</span>
<span class="source-lf">
, 
</span>
<span class="source-lf constant-numeric-int-lflang">
8
</span>
<span class="source-lf">
};
</span>

<span class="source-lf">
    for(int j 
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
 
</span>
<span class="source-lf constant-numeric-int-lflang">
0
</span>
<span class="source-lf">
; j < i_width; j
</span>
<span class="source-lf keyword-operator-lflang">
+
</span>
<span class="source-lf keyword-operator-lflang">
+
</span>
<span class="source-lf">
) {
</span>

<span class="source-lf">
      lf_print(
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf string-quoted-double-lflang">
C received %d.
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf">
, i[j]
</span>
<span class="source-lf keyword-operator-lflang">
->
</span>
<span class="source-lf">
value);
</span>

<span class="source-lf">
      if (i[j]
</span>
<span class="source-lf keyword-operator-lflang">
->
</span>
<span class="source-lf">
value !
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
 expected[j]) {
</span>

<span class="source-lf">
        lf_print_error_and_exit(
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf string-quoted-double-lflang">
Expected %d.
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf">
, expected[j]);
</span>

<span class="source-lf">
      }
</span>

<span class="source-lf">
    }
</span>

<span class="source-lf">
  
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
}
</span>

<span class="source-lf">
}
</span>

<span class="source-lf">

</span>

<span class="source-lf storage-modifier-lflang">
main
</span>
<span class="source-lf">
 
</span>
<span class="source-lf storage-modifier-lflang">
reactor
</span>
<span class="source-lf">
 {
</span>

<span class="source-lf">
  
</span>
<span class="source-lf variable-other-constant-reactorinstance-lflang">
b
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-control-new-lflang">
new
</span>
<span class="source-lf">
[
</span>
<span class="source-lf constant-numeric-int-lflang">
2
</span>
<span class="source-lf">
] B()
</span>

<span class="source-lf">
  
</span>
<span class="source-lf variable-other-constant-reactorinstance-lflang">
c
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-control-new-lflang">
new
</span>
<span class="source-lf">
 
</span>
<span class="source-lf entity-name-type-lflang">
C
</span>
<span class="source-lf">
()
</span>

<span class="source-lf">
  
</span>
<span class="source-lf variable-other-constant-reactorinstance-lflang">
b
</span>
<span class="source-lf keyword-operator-lflang">
.
</span>
<span class="source-lf variable-other-lflang">
q
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-operator-lflang">
->
</span>
<span class="source-lf">
 
</span>
<span class="source-lf variable-other-constant-reactorinstance-lflang">
c
</span>
<span class="source-lf keyword-operator-lflang">
.
</span>
<span class="source-lf variable-other-lflang">
i
</span>

<span class="source-lf">
}
</span>

<span class="source-lf">

</span>

