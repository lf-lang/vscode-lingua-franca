<span class="source-lf comment-block-lflang">
/**
</span>

<span class="source-lf comment-block-lflang">
 * This test ensures that level 2 reaction with a tighter deadline runs before a level 1 reaction
</span>

<span class="source-lf comment-block-lflang">
 * with a looser deadline when there is no dependency between these reactions. This is the correct
</span>

<span class="source-lf comment-block-lflang">
 * behavior of the GEDF scheduler, so the scheduler is set to GEDF_NP.
</span>

<span class="source-lf comment-block-lflang">
 
</span>
<span class="source-lf comment-block-lflang">
*/
</span>

<span class="source-lf meta-targetspec-lflang keyword-control-lflang">
target
</span>
<span class="source-lf meta-targetspec-lflang">
 
</span>
<span class="source-lf meta-targetspec-lflang constant-language-lflang">
C
</span>
<span class="source-lf meta-targetspec-lflang">
 {
</span>

<span class="source-lf meta-targetspec-lflang variable-parameter-lflang">
  timeout
</span>
<span class="source-lf meta-targetspec-lflang">
: 
</span>
<span class="source-lf meta-targetspec-lflang constant-numeric-int-lflang">
200
</span>
<span class="source-lf meta-targetspec-lflang">
 ms,
</span>

<span class="source-lf meta-targetspec-lflang variable-parameter-lflang">
  scheduler
</span>
<span class="source-lf meta-targetspec-lflang">
: 
</span>
<span class="source-lf meta-targetspec-lflang storage-type-lflang">
GEDF_NP
</span>
<span class="source-lf meta-targetspec-lflang">
,
</span>

<span class="source-lf meta-targetspec-lflang variable-parameter-lflang">
  workers
</span>
<span class="source-lf meta-targetspec-lflang">
: 
</span>
<span class="source-lf meta-targetspec-lflang constant-numeric-int-lflang">
1
</span>

<span class="source-lf meta-targetspec-lflang">
}
</span>

<span class="source-lf">

</span>

<span class="source-lf storage-modifier-lflang">
reactor
</span>
<span class="source-lf">
 
</span>
<span class="source-lf entity-name-type-lflang">
Periodic
</span>
<span class="source-lf">
(period: 
</span>
<span class="source-lf storage-type-lflang">
time
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
 
</span>
<span class="source-lf constant-numeric-int-lflang">
50
</span>
<span class="source-lf">
 ms, name: 
</span>
<span class="source-lf storage-type-lflang">
string
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
 
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf string-quoted-double-lflang">
Unnamed
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf">
) {
</span>

<span class="source-lf">
  
</span>
<span class="source-lf storage-modifier-lflang">
timer
</span>
<span class="source-lf">
 trigger(
</span>
<span class="source-lf constant-numeric-int-lflang">
0
</span>
<span class="source-lf">
, period)
</span>

<span class="source-lf">

</span>

<span class="source-lf">
  
</span>
<span class="source-lf storage-modifier-lflang">
output
</span>
<span class="source-lf">
 
</span>
<span class="source-lf variable-other-lflang">
t
</span>
<span class="source-lf">
:
</span>
<span class="source-lf meta-embedded-block-cpp">
 
</span>
<span class="source-lf meta-embedded-block-cpp storage-type-lflang">
time
</span>

<span class="source-lf">

</span>

<span class="source-lf">
  
</span>
<span class="source-lf keyword-control-lflang">
reaction
</span>
<span class="source-lf">
(
</span>
<span class="source-lf">
trigger) 
</span>
<span class="source-lf keyword-operator-lflang">
->
</span>
<span class="source-lf">
 t {
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>

<span class="source-lf">
    instant_t start_time 
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
 lf_time_physical_elapsed();
</span>

<span class="source-lf">
    lf_set(t, start_time);
</span>

<span class="source-lf">
    lf_print(
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf string-quoted-double-lflang">
%s started at physical time: 
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf">
 PRINTF_TIME, self
</span>
<span class="source-lf keyword-operator-lflang">
->
</span>
<span class="source-lf">
name, start_time);
</span>

<span class="source-lf">
  
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
}
</span>

<span class="source-lf">
}
</span>

<span class="source-lf">

</span>

<span class="source-lf storage-modifier-lflang">
reactor
</span>
<span class="source-lf">
 
</span>
<span class="source-lf entity-name-type-lflang">
Probe
</span>
<span class="source-lf">
(dl: 
</span>
<span class="source-lf storage-type-lflang">
time
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
 
</span>
<span class="source-lf constant-numeric-int-lflang">
2
</span>
<span class="source-lf">
 ms, name: 
</span>
<span class="source-lf storage-type-lflang">
string
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
 
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf string-quoted-double-lflang">
Unnamed
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf">
) {
</span>

<span class="source-lf">
  
</span>
<span class="source-lf storage-modifier-lflang">
input
</span>
<span class="source-lf">
 
</span>
<span class="source-lf variable-other-lflang">
i
</span>
<span class="source-lf">
:
</span>
<span class="source-lf meta-embedded-block-cpp">
 
</span>
<span class="source-lf meta-embedded-block-cpp storage-type-lflang">
time
</span>

<span class="source-lf">
  
</span>
<span class="source-lf storage-modifier-lflang">
output
</span>
<span class="source-lf">
 
</span>
<span class="source-lf variable-other-lflang">
t
</span>
<span class="source-lf">
:
</span>
<span class="source-lf meta-embedded-block-cpp">
 
</span>
<span class="source-lf meta-embedded-block-cpp storage-type-lflang">
time
</span>

<span class="source-lf">

</span>

<span class="source-lf">
  
</span>
<span class="source-lf keyword-control-lflang">
reaction
</span>
<span class="source-lf">
(
</span>
<span class="source-lf">
i) 
</span>
<span class="source-lf keyword-operator-lflang">
->
</span>
<span class="source-lf">
 t {
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>

<span class="source-lf">
    instant_t start_time 
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
 lf_time_physical_elapsed();
</span>

<span class="source-lf">
    lf_set(t, start_time);
</span>

<span class="source-lf">
    lf_print(
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf string-quoted-double-lflang">
%s started at physical time: 
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf">
 PRINTF_TIME, self
</span>
<span class="source-lf keyword-operator-lflang">
->
</span>
<span class="source-lf">
name, start_time);
</span>

<span class="source-lf">
  
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
} 
</span>
<span class="source-lf keyword-control-lflang">
deadline
</span>
<span class="source-lf">
(dl) {
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>

<span class="source-lf">
    instant_t start_time 
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
 lf_time_physical_elapsed();
</span>

<span class="source-lf">
    lf_set(t, start_time);
</span>

<span class="source-lf">
    lf_print(
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf string-quoted-double-lflang">
%s VIOLATED DEADLINE at physical time: 
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf">
 PRINTF_TIME, self
</span>
<span class="source-lf keyword-operator-lflang">
->
</span>
<span class="source-lf">
name, start_time);
</span>

<span class="source-lf">
  
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
}
</span>

<span class="source-lf">
}
</span>

<span class="source-lf">

</span>

<span class="source-lf storage-modifier-lflang">
main
</span>
<span class="source-lf">
 
</span>
<span class="source-lf storage-modifier-lflang">
reactor
</span>
<span class="source-lf">
 {
</span>

<span class="source-lf">
  
</span>
<span class="source-lf variable-other-constant-reactorinstance-lflang">
task1
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-control-new-lflang">
new
</span>
<span class="source-lf">
 
</span>
<span class="source-lf entity-name-type-lflang">
Periodic
</span>
<span class="source-lf">
(period 
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
 
</span>
<span class="source-lf constant-numeric-int-lflang">
50
</span>
<span class="source-lf">
 ms, name
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf string-quoted-double-lflang">
task1
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf">
)
</span>

<span class="source-lf">
  
</span>
<span class="source-lf variable-other-constant-reactorinstance-lflang">
detector1
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-control-new-lflang">
new
</span>
<span class="source-lf">
 
</span>
<span class="source-lf entity-name-type-lflang">
Probe
</span>
<span class="source-lf">
(dl 
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
 
</span>
<span class="source-lf constant-numeric-int-lflang">
50
</span>
<span class="source-lf">
 ms, name
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf string-quoted-double-lflang">
detector1
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf">
)
</span>

<span class="source-lf">

</span>

<span class="source-lf">
  
</span>
<span class="source-lf variable-other-constant-reactorinstance-lflang">
task1
</span>
<span class="source-lf keyword-operator-lflang">
.
</span>
<span class="source-lf variable-other-lflang">
t
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-operator-lflang">
->
</span>
<span class="source-lf">
 
</span>
<span class="source-lf variable-other-constant-reactorinstance-lflang">
detector1
</span>
<span class="source-lf keyword-operator-lflang">
.
</span>
<span class="source-lf variable-other-lflang">
i
</span>

<span class="source-lf">
  
</span>
<span class="source-lf variable-other-constant-reactorinstance-lflang">
task2
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-control-new-lflang">
new
</span>
<span class="source-lf">
 
</span>
<span class="source-lf entity-name-type-lflang">
Periodic
</span>
<span class="source-lf">
(period 
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
 
</span>
<span class="source-lf constant-numeric-int-lflang">
50
</span>
<span class="source-lf">
 ms, name
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf string-quoted-double-lflang">
task2
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf">
)
</span>

<span class="source-lf">
  
</span>
<span class="source-lf variable-other-constant-reactorinstance-lflang">
detector2
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-control-new-lflang">
new
</span>
<span class="source-lf">
 
</span>
<span class="source-lf entity-name-type-lflang">
Probe
</span>
<span class="source-lf">
(dl 
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
 
</span>
<span class="source-lf constant-numeric-int-lflang">
25
</span>
<span class="source-lf">
 ms, name
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf string-quoted-double-lflang">
detector2
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf">
)
</span>

<span class="source-lf">

</span>

<span class="source-lf">
  
</span>
<span class="source-lf variable-other-constant-reactorinstance-lflang">
task2
</span>
<span class="source-lf keyword-operator-lflang">
.
</span>
<span class="source-lf variable-other-lflang">
t
</span>
<span class="source-lf">
 
</span>
<span class="source-lf keyword-operator-lflang">
->
</span>
<span class="source-lf">
 
</span>
<span class="source-lf variable-other-constant-reactorinstance-lflang">
detector2
</span>
<span class="source-lf keyword-operator-lflang">
.
</span>
<span class="source-lf variable-other-lflang">
i
</span>

<span class="source-lf">

</span>

<span class="source-lf">
  
</span>
<span class="source-lf keyword-control-lflang">
reaction
</span>
<span class="source-lf">
(
</span>
<span class="source-lf variable-other-constant-reactorinstance-lflang">
task1
</span>
<span class="source-lf keyword-operator-lflang">
.
</span>
<span class="source-lf variable-other-lflang">
t
</span>
<span class="source-lf">
, 
</span>
<span class="source-lf variable-other-constant-reactorinstance-lflang">
detector2
</span>
<span class="source-lf keyword-operator-lflang">
.
</span>
<span class="source-lf variable-other-lflang">
t
</span>
<span class="source-lf">
) {
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>

<span class="source-lf">
    if (
</span>
<span class="source-lf variable-other-constant-reactorinstance-lflang">
task1
</span>
<span class="source-lf keyword-operator-lflang">
.
</span>
<span class="source-lf variable-other-lflang">
t
</span>
<span class="source-lf keyword-operator-lflang">
->
</span>
<span class="source-lf">
is_present && 
</span>
<span class="source-lf variable-other-constant-reactorinstance-lflang">
detector2
</span>
<span class="source-lf keyword-operator-lflang">
.
</span>
<span class="source-lf variable-other-lflang">
t
</span>
<span class="source-lf keyword-operator-lflang">
->
</span>
<span class="source-lf">
is_present && 
</span>
<span class="source-lf variable-other-constant-reactorinstance-lflang">
task1
</span>
<span class="source-lf keyword-operator-lflang">
.
</span>
<span class="source-lf variable-other-lflang">
t
</span>
<span class="source-lf keyword-operator-lflang">
->
</span>
<span class="source-lf">
value < 
</span>
<span class="source-lf variable-other-constant-reactorinstance-lflang">
detector2
</span>
<span class="source-lf keyword-operator-lflang">
.
</span>
<span class="source-lf variable-other-lflang">
t
</span>
<span class="source-lf keyword-operator-lflang">
->
</span>
<span class="source-lf">
value) {
</span>

<span class="source-lf">
      lf_print_error_and_exit(
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf string-quoted-double-lflang">
EDF policy violated. detector2 should execute before task1 when both are triggered.
</span>
<span class="source-lf string-quoted-double-lflang">
"
</span>
<span class="source-lf">
);
</span>

<span class="source-lf">
    }
</span>

<span class="source-lf">
  
</span>
<span class="source-lf keyword-operator-lflang">
=
</span>
<span class="source-lf">
}
</span>

<span class="source-lf">
}
</span>

<span class="source-lf">

</span>

